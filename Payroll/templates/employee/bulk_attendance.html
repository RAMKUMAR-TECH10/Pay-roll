{% extends "base.html" %}

{% block title %}Bulk Attendance{% endblock %}
{% block header %}Mark Bulk Attendance{% endblock %}

{% block content %}
<div class="container">
    <div class="card" style="margin-bottom: 30px;">
        <h3>üìÖ Select Date & Mark Attendance</h3>

        <form method="POST" action="{{ url_for('employee.bulk_attendance') }}">
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: var(--text-color); font-weight: 600;">
                    Attendance Date
                </label>
                <input type="date" name="date" value="{{ attendance_date }}" required
                    class="form-control form-control-lg"
                    onchange="document.location.href='{{ url_for('employee.bulk_attendance') }}?date=' + this.value;"
                    style="max-width: 300px;">
                <small style="color: var(--text-color); margin-top: 5px; display: block;">
                    Select a date to mark attendance for all employees on that date.
                </small>
            </div>

            <!-- Employees Table -->
            <div
                style="background: var(--card-bg); border-radius: 12px; padding: 20px; margin-top: 20px; overflow-x: auto;">
                <h4 style="margin-top: 0; color: var(--accent-color); margin-bottom: 20px;">
                    üë• Mark Attendance for {{ employees|length }} Employees
                </h4>

                <table class="table" style="width: 100%; border-collapse: collapse;">
                    <thead style="border-bottom: 2px solid var(--border-color);">
                        <tr>
                            <th style="padding: 12px; text-align: left; color: #8b949e;">Employee</th>
                            <th style="padding: 12px; text-align: left; color: #8b949e;">Position/Dept</th>
                            <th style="padding: 12px; text-align: left; color: #8b949e;">Attendance Status</th>
                            <th style="padding: 12px; text-align: left; color: #8b949e;">Current Info</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for emp in employees %}
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 15px; vertical-align: middle;">
                                <div style="font-weight: 600; color: var(--accent-color);">{{ emp.get_full_name() }}
                                </div>
                                <div style="font-size: 0.75rem; color: #8b949e;">{{ emp.employee_id }}</div>
                            </td>
                            <td style="padding: 15px; vertical-align: middle;">
                                <div style="font-size: 0.9rem;">{{ emp.position }}</div>
                                <div style="font-size: 0.75rem; color: #8b949e;">{{ emp.department }}</div>
                            </td>
                            <td style="padding: 15px; vertical-align: middle;">
                                <select name="status_{{ emp.id }}" class="form-select"
                                    style="max-width: 200px; padding: 8px; border-radius: 6px; background: #1e293b; color: white; border: 1px solid #334155;">
                                    <option value="present" {% if existing_attendance.get(emp.id, 'present' )=='present'
                                        %}selected{% endif %}>‚úÖ Present</option>
                                    <option value="absent" {% if existing_attendance.get(emp.id)=='absent' %}selected{%
                                        endif %}>‚ùå Absent</option>
                                    <option value="late" {% if existing_attendance.get(emp.id)=='late' %}selected{%
                                        endif %}>‚è∞ Late</option>
                                    <option value="leave" {% if existing_attendance.get(emp.id)=='leave' %}selected{%
                                        endif %}>üèñ Leave</option>
                                    <option value="sick" {% if existing_attendance.get(emp.id)=='sick' %}selected{%
                                        endif %}>ü§í Sick</option>
                                    <option value="half-day" {% if existing_attendance.get(emp.id)=='half-day'
                                        %}selected{% endif %}>‚è± Half-Day</option>
                                </select>
                            </td>
                            <td style="padding: 15px; vertical-align: middle;">
                                {% set last_status = existing_attendance.get(emp.id) %}
                                {% if last_status %}
                                <span style="font-size: 0.85rem; padding: 4px 10px; border-radius: 20px; 
                                        {% if last_status == 'present' %} background: rgba(34, 197, 94, 0.1); color: #22c55e;
                                        {% elif last_status == 'absent' %} background: rgba(239, 68, 68, 0.1); color: #ef4444;
                                        {% else %} background: rgba(245, 158, 11, 0.1); color: #f59e0b; {% endif %}">
                                    Saved: {{ last_status|capitalize }}
                                </span>
                                {% else %}
                                <span style="font-size: 0.85rem; color: #8b949e; font-style: italic;">Not marked</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Submit Button -->
            <div style="margin-top: 30px; display: flex; gap: 10px;">
                <button type="submit" class="btn btn-primary"
                    style="flex: 1; padding: 15px; font-size: 1rem; border-radius: 10px;">
                    ‚úÖ Save All Attendance Records
                </button>
                <a href="{{ url_for('employee.attendance_list') }}" class="btn"
                    style="padding: 15px; background-color: #334155; color: white; border: none; border-radius: 10px; text-decoration: none; flex: 1; text-align: center;">
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <!-- Instructions -->
    <div class="card" style="background: rgba(88, 166, 255, 0.05); border: 1px solid rgba(88, 166, 255, 0.2);">
        <h4 style="margin-top: 0; color: var(--accent-color);">üìã How to Use</h4>
        <ol style="color: var(--text-color); line-height: 1.8;">
            <li><strong>Select a Date:</strong> Use the date field at the top to choose which date to mark attendance
                for.</li>
            <li><strong>Mark Status:</strong> For each employee, select their attendance status (Present, Absent, Late,
                etc.).</li>
            <li><strong>Save:</strong> Click "Confirm & Save Attendance" to save all entries at once.</li>
            <li><strong>Edit:</strong> You can re-open this page and change statuses until you're happy with them.</li>
        </ol>
    </div>
</div>

<style>
    .container {
        max-width: 1400px;
        margin: 0 auto;
    }
</style>
{% endblock %}